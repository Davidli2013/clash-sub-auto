name: Auto Update Clash Sub
on:
  schedule:
    - cron: '0 0 * * *'  # 每天凌晨0点（UTC时间）自动更新，对应北京时间早8点
  workflow_dispatch:    # 允许你手动触发更新

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Sub-Store
        run: npm install -g sub-store-cli

      - name: Run Sub-Store
        run: sub-store run -c config.yaml

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto update clash subscription"
          file_pattern: 'sub.yaml'
